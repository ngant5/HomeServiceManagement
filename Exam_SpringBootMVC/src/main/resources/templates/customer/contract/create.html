<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Clean</title>
    <th:block th:insert="~{common/home_head_tag}"></th:block>
</head>
<body>
    <th:block th:insert="~{common/home_content_first}"></th:block>

    <section class="contained">
        <h2 class="section-title ff-damion">Request a Service</h2>
        <p class="col-wide ta-center mlmr-a">
            Please fill out the form below to request more information or book a service.
        </p>
        <!-- FORM START -->
        <form th:action="@{/contracts/checkout}" method="post" class="message-form mt-50 mb-25">
            <input type="hidden" th:value="${session.customerId}">
            <div class="row">
                <!-- CONTACT INFO START -->
                <div class="col-balance map-embed">
                    <input type="hidden" name="empServiceId" value="yourEmpServiceIdValue" />
                    <input type="hidden" name="contractId" value="yourContractIdValue" />
                    <input type="hidden" name="contractStatus" value="0" />
                    <input type="hidden" name="paymentStatus" value="0" />

                    <h2 class="fs-h4 fc-primary mb-15">Request Information</h2>

                    <!-- Select Time Type -->
                    <span class="fs-h4 mb-15 mt-25 fc-primary">Select Service Duration Type:</span>
                    <div class="input-group">
                        <i class="bi bi-calendar-range"></i>
                        <select name="durationType" id="durationType" onchange="toggleDurationFields()" required>
                            <option value="" disabled selected>Select Duration Type</option>
                            <option value="one_time">One Time</option>
                            <option value="by_day">By Day</option>
                            <option value="by_month">Monthly</option>
                        </select>
                    </div>

                
					    <span class="fs-h4 mb-15 mt-25 fc-primary">Select Service Time:</span>
					    <div class="input-group">
					        <i class="bi bi-clock"></i>
					        <select name="startTime" id="startTime" required onchange="setEndTimeMin()">
					            <option value="" disabled selected>Select Start Time</option>
					            <option value="08:00">08:00</option>
					            <option value="09:00">09:00</option>
					            <option value="10:00">10:00</option>
					            <option value="11:00">11:00</option>
					            <option value="12:00">12:00</option>
					            <option value="13:00">13:00</option>
					            <option value="14:00">14:00</option>
					            <option value="15:00">15:00</option>
					            <option value="16:00">16:00</option>
					            <option value="17:00">17:00</option>
					            <option value="18:00">18:00</option>
					            <option value="19:00">19:00</option>
					        </select>
					        to
					        <select name="endTime" id="endTime" required>
					            <option value="" disabled selected>Select End Time</option>
					            <option value="09:00">09:00</option>
					            <option value="10:00">10:00</option>
					            <option value="11:00">11:00</option>
					            <option value="12:00">12:00</option>
					            <option value="13:00">13:00</option>
					            <option value="14:00">14:00</option>
					            <option value="15:00">15:00</option>
					            <option value="16:00">16:00</option>
					            <option value="17:00">17:00</option>
					            <option value="18:00">18:00</option>
					            <option value="19:00">19:00</option>
					            <option value="20:00">20:00</option>
					        </select>
					    </div>
                  
					
						<!-- One Time Duration Fields -->
						<div id="durationFields">
							<span class="fs-h4 mb-15 mt-25 fc-primary">Select Service Date:</span>
							<div class="input-group">
								<i class="bi bi-calendar-event"></i>
								<input type="date" name="serviceDate" id="serviceDate" required />
							</div>
						</div>
			
					<!-- Monthly Duration Fields -->
					<div id="monthlyDurationFields" style="display:none;">
						<span class="fs-h4 mb-15 mt-25 fc-primary">Start Date:</span>
					    <div class="input-group">
					        <i class="bi bi-calendar-event"></i>
					        <input type="date" name="startDate" id="startDate" required />
					    </div>

					    <span class="fs-h4 mb-15 mt-25 fc-primary">End Date:</span>
					    <div class="input-group">
					        <i class="bi bi-calendar-event"></i>
					        <input type="date" name="endDate" id="endDate" required />
					    </div>

					    <span class="fs-h4 mb-15 mt-25 fc-primary">Working Hours Per Day:</span>
					    <div class="input-group">
					        <i class="bi bi-clock"></i>
					        <select id="workingHoursPerDay" name="workingHoursPerDay" required>
					            <option value="" disabled selected>Select working hours per day</option>
					            <option value="1">1 hour/day</option>
					            <option value="2">2 hours/day</option>
					            <option value="4">4 hours/day</option>
					            <option value="8">8 hours/day</option>
					        </select>
					    </div>

					    <span class="fs-h4 mb-15 mt-25 fc-primary">Number of Working Days Per Week:</span>
					    <div class="input-group">
					        <i class="bi bi-calendar-week"></i>
					        <select id="workingDaysPerWeek" name="workingDaysPerWeek" required>
					            <option value="" disabled selected>Select working days per week</option>
					            <option value="1">1 day/week</option>
					            <option value="2">2 days/week</option>
					            <option value="3">3 days/week</option>
					            <option value="4">4 days/week</option>
					            <option value="5">5 days/week</option>
					            <option value="6">6 days/week</option>
					            <option value="7">7 days/week</option>
					        </select>
					    </div>
					</div>


                    <!-- Service Location -->
                    <span class="fs-h4 mb-15 mt-25 fc-primary">Where to go:</span>
                    <a class="display-inblock">
                        <i class="bi bi-geo-alt-fill"></i>
                        <input type="text" name="serviceAddress" placeholder="Service location address." required />
                    </a>

                    <!-- Contact Information -->
                    <span class="fs-h4 mb-15 mt-25 fc-primary">Say hello:</span>
                    <a class="display-inblock">
                        <i class="bi bi-telephone-fill"></i>
                        <input type="text" name="servicePhone" placeholder="Your Phone Number" required />
                    </a>

                    <!-- Hidden Field for Total Hours -->
                    <input type="hidden" id="totalHours" name="hoursWorked" required />

                    <!-- Submit Button -->
                    <button type="submit" class="btn-bg1 border-round mt-20">Send</button>
                </div>
            </div>
        </form>
        <!-- FORM END -->

    </section>
    <!-- ========== section end ========== -->

    <th:block th:insert="~{common/home_content_footer}"></th:block>

    <script>
        // Hàm để ẩn/hiện các trường theo loại thời gian đã chọn
        function toggleDurationFields() {
            const durationType = document.getElementById('durationType').value; // Lấy giá trị loại thời gian
            const oneTimeFields = document.getElementById('durationFields'); // Trường thời gian theo "One Time"
            const monthlyFields = document.getElementById('monthlyDurationFields'); // Trường thời gian theo tháng

            // Điều chỉnh hiển thị các trường theo loại thời gian đã chọn
            if (durationType === 'one_time') {
                oneTimeFields.style.display = 'block';  // Hiển thị trường "One Time"
                monthlyFields.style.display = 'none'; 
				
				const today = new Date();
				const tomorrow = new Date(today);
				tomorrow.setDate(today.getDate() + 1);  // Ngày mai
				const minDate = tomorrow.toISOString().split('T')[0];  // Định dạng "yyyy-mm-dd"
				document.getElementById('serviceDate').setAttribute('min', minDate);  // Ẩn các trường theo tháng
            } else if (durationType === 'by_day' || durationType === 'by_month') {
                oneTimeFields.style.display = 'none';  // Ẩn "One Time"
                monthlyFields.style.display = 'block';  // Hiển thị các trường theo tháng
            }
        }
		
		function setEndTimeMin() {
		    const startTime = document.getElementById("startTime").value;
		    const endTime = document.getElementById("endTime");

		    // Clear current options in endTime dropdown
		    endTime.innerHTML = '<option value="" disabled selected>Select End Time</option>';

		    // Define available end times based on selected start time
		    const timeSlots = [
		        "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00"
		    ];

		    let startIndex = timeSlots.indexOf(startTime);
		    if (startIndex !== -1) {
		        // Add the available times starting from the hour after the selected start time
		        for (let i = startIndex + 1; i < timeSlots.length; i++) {
		            const option = document.createElement("option");
		            option.value = timeSlots[i];
		            option.textContent = timeSlots[i];
		            endTime.appendChild(option);
		        }
		    }
		}
				
		// Ngăn không cho người dùng nhập dữ liệu vào ô thời gian
		document.getElementById('startTime').addEventListener('keydown', function(event) {
		    event.preventDefault();  // Ngăn không cho nhập vào ô
		});


		// Đảm bảo giá trị vẫn được lưu lại khi người dùng chọn giờ
		document.getElementById('startTime').addEventListener('change', function(event) {
		    // Đảm bảo giá trị được lấy đúng khi người dùng chọn giờ
		    let startTimeValue = event.target.value;
		    console.log('Start Time:', startTimeValue); // Kiểm tra giá trị được chọn
		});

		document.getElementById('endTime').addEventListener('change', function(event) {
		    // Đảm bảo giá trị được lấy đúng khi người dùng chọn giờ
		    let endTimeValue = event.target.value;
		    console.log('End Time:', endTimeValue); // Kiểm tra giá trị được chọn
		});
		function setStartAndEndDate() {
		    var today = new Date();
		    
		    // Ngày mai (Start Date)
		    var tomorrow = new Date(today);
		    tomorrow.setDate(today.getDate() + 1); // Ngày mai

		    // Thiết lập giá trị cho Start Date
		    var startDate = document.getElementById('startDate');
		    var startDateString = tomorrow.toISOString().split('T')[0]; // Định dạng ngày "yyyy-mm-dd"
		    startDate.value = startDateString; // Đặt giá trị cho Start Date
		    startDate.setAttribute('min', startDateString); // Chỉ cho phép chọn ngày mai hoặc ngày sau

		    // Thiết lập giá trị cho End Date (Ngày sau Start Date)
		    var endDate = document.getElementById('endDate');
		    tomorrow.setDate(tomorrow.getDate() + 1); // Ngày kết thúc là ngày sau Start Date
		    var endDateString = tomorrow.toISOString().split('T')[0]; // Định dạng ngày "yyyy-mm-dd"
		    endDate.value = endDateString; // Đặt giá trị cho End Date
		    endDate.setAttribute('min', endDateString); // Đảm bảo End Date luôn lớn hơn Start Date

			startDate.addEventListener('change', function() {
			        updateEndDateMin(); 
			    });

		    // Gắn sự kiện thay đổi cho End Date
		    endDate.addEventListener('change', validateEndDate);
		}

		// Hàm cập nhật min của End Date sau khi chọn Start Date
		function updateEndDateMin() {
		    var startDate = document.getElementById('startDate').value;
		    var endDate = document.getElementById('endDate');
		    
		    if (startDate) {
		        var start = new Date(startDate);
				var durationType = document.getElementById('durationType').value;
				if (durationType === 'by_month') {
					start.setDate(start.getDate() + 31); // End Date phải lớn hơn Start Date 30 ngày
				} else {
					start.setDate(start.getDate() + 1); // Nếu không, chỉ cần End Date sau Start Date 1 ngày
				}

				var endDateValue = start.toISOString().split('T')[0]; // Định dạng ngày "yyyy-mm-dd"
				endDate.setAttribute('min', endDateValue);
		        if (new Date(endDate.value) < new Date(endDateValue)) {
		            endDate.value = endDateValue; // Cập nhật End Date nếu người dùng chọn nhỏ hơn min
		        }
		    }
		}

		// Hàm kiểm tra End Date để đảm bảo nó không nhỏ hơn Start Date + 1 ngày
		function validateEndDate() {
		    const startDate = document.getElementById('startDate').value;
		    const endDate = document.getElementById('endDate').value;
		    
		    if (startDate && endDate) {
		        const start = new Date(startDate);
		        const end = new Date(endDate);

		        // Đảm bảo End Date không nhỏ hơn Start Date + 1
		        start.setDate(start.getDate() + 1); // Tính ngày sau Start Date

		        if (end < start) {
		            alert('End Date must be at least one day after Start Date.');
		            document.getElementById('endDate').value = ''; // Xóa giá trị End Date nếu không hợp lệ
		        }
		    }
		}

		window.onload = function() {
		    // Thiết lập Start Date và End Date khi trang tải
		    setStartAndEndDate();
		};


    </script>

</body>
</html>
