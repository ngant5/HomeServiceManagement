<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Employee Reviews</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Employee Reviews for Contract ID: <span th:text="${contractId}"></span></h1>

    <!-- Hiển thị các Emp Service ID -->
    <h3>Emp Service IDs:</h3>
    <ul>
        <li th:each="empServiceId : ${empServiceIds}" th:text="${empServiceId}"></li>
    </ul>


	<ul>
	    <li th:each="employeeInfo : ${employeeInfoList}">
	        <span th:text="${employeeInfo.employeeId}">Employee ID</span> - 
	        <span th:text="${employeeInfo.employeeName}">Employee Full Name</span>
	    </li>
	</ul>
    <!-- Hiển thị các đánh giá nhân viên -->
    <h3>Employee Reviews:</h3>
    <ul>
        <li th:each="review : ${employeeReviews}">
            <span th:text="${review.fullname}">Employee Full Name</span> -
            <span th:text="${review.rating}">Rating</span> -
            <span th:text="${review.comment}">Comment</span> -
            <span th:text="${review.createdAt}">Created At</span>
        </li>
    </ul>

    <!-- Form tạo hoặc cập nhật đánh giá -->
    <h3>Submit a Review</h3>
    <form id="reviewForm" th:action="@{/employee-reviews/submit}" method="POST">
        <input type="hidden" name="contractDetailId" th:value="${contractDetailId}" />
        <input type="hidden" name="employeeId" th:value="${employeeId}" />
		

        <label for="rating">Rating:</label>
        <input type="number" id="rating" name="rating" min="1" max="5" required />

        <br/><br/>

        <label for="comment">Comment:</label>
        <textarea id="comment" name="comment" required></textarea>

        <br/><br/>

        <button type="submit">Submit Review</button>
    </form>

    <div id="responseMessage"></div> <!-- Để hiển thị kết quả trả về -->

    <script>
		$("#reviewForm").submit(function(event) {
		    event.preventDefault();  // Ngừng việc gửi form mặc định

		    // Thu thập dữ liệu từ form
		    var formData = $(this).serialize(); // Thu thập tất cả các input trong form
		    console.log(formData);  // Kiểm tra dữ liệu form

		    // Kiểm tra xem rating có hợp lệ không
		    var rating = $("#rating").val();
		    if (!rating || isNaN(rating) || rating < 1 || rating > 5) {
		        alert("Please enter a valid rating between 1 and 5.");
		        return;  // Dừng lại nếu rating không hợp lệ
		    }

		    // Gửi dữ liệu AJAX đến server
		    $.ajax({
		        url: '/employee-reviews/submit',  // Đảm bảo URL đúng với controller
		        type: 'POST',
		        data: formData,
		        success: function(response) {
		            // Hiển thị kết quả trả về (nếu có)
		            $("#responseMessage").html("<p>Review submitted successfully!</p>");
		            // Có thể thêm logic để làm mới phần danh sách đánh giá ở đây nếu cần
		        },
		        error: function(xhr, status, error) {
		            // Hiển thị thông báo lỗi nếu có
		            $("#responseMessage").html("<p style='color:red;'>Error occurred: " + xhr.responseText + "</p>");
		            console.log(xhr);  // Kiểm tra thêm thông tin lỗi từ response
		        }
		    });
		});
    </script>
</body>
</html>
